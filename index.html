<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>BSC con IA</title>
  <link rel="stylesheet" href="styles.css" />
  <script type="importmap">
  {
    "imports": {
      "d3": "https://esm.sh/d3@7.9.0",
      "dagre": "https://esm.sh/dagre@0.8.5",
      "papaparse": "https://esm.sh/papaparse@5.4.1",
      "jspdf": "https://esm.sh/jspdf@2.5.1",
      "pptxgen": "https://esm.sh/pptxgenjs@3.12.0"
    }
  }
  </script>
</head>
<body>
  <div id="app">
    <div id="topbar">
      <button class="icon" id="btn-setup" title="Configurar">⚙️</button>
      <div id="segmented">
        <button data-view="mapa" class="seg active">Mapa</button>
        <button data-view="tableros" class="seg">Perspectivas</button>
        <button data-view="maestro" class="seg">Maestro</button>
        <button data-view="detalle" class="seg">KPI</button>
        <button data-view="export" class="seg">Exportar</button>
      </div>
      <button class="icon" id="btn-help" title="Ayuda">❔</button>
    </div>

    <div id="content">
      <!-- MAPA ESTRATÉGICO -->
      <section id="view-mapa" class="view active">
        <div id="mapa-toolbar">
          <select id="perspFilter"></select>
          <button id="btn-auto">Auto-layout</button>
          <button id="btn-png">PNG</button>
        </div>
        <div id="mapa-wrap">
          <svg id="mapa-svg" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
        <img id="ref-img" src="/Gemini_Generated_Image_lhlxu6lhlxu6lhlx.png" alt="Referencia BSC" />
      </section>

      <!-- TABLEROS POR PERSPECTIVA -->
      <section id="view-tableros" class="view">
        <div id="tabs-persp"></div>
        <div id="cards"></div>
      </section>

      <!-- TABLERO MAESTRO -->
      <section id="view-maestro" class="view">
        <div id="maestro-summary">
          <div class="gauge">
            <div id="gauge-val">0%</div>
            <div id="gauge-light" class="rag red"></div>
          </div>
          <div id="persp-bars"></div>
        </div>
      </section>

      <!-- DETALLE KPI -->
      <section id="view-detalle" class="view">
        <div id="kpi-header">
          <select id="kpi-select"></select>
          <button id="btn-add-data">Cargar dato</button>
          <button id="btn-import-csv">CSV</button>
        </div>
        <div id="kpi-meta"></div>
        <canvas id="kpi-chart" width="600" height="160"></canvas>
        <div id="kpi-props"></div>
      </section>

      <!-- EXPORTACIONES -->
      <section id="view-export" class="view">
        <div id="export-actions">
          <button id="export-json">JSON</button>
          <button id="export-csv">CSV</button>
          <button id="export-pdf">PDF</button>
          <button id="export-ppt">PPT</button>
        </div>
        <div id="export-note">Exporta tablero, datos y mapa estratégico.</div>
      </section>
    </div>
  </div>

  <!-- BOTTOM SHEETS / MODALES -->
  <div id="sheet" class="hidden">
    <div id="sheet-handle"></div>
    <div id="sheet-content"></div>
  </div>

  <script type="module" src="./state.js"></script>
  <script type="module" src="./ai.js"></script>
  <script type="module" src="./graph.js"></script>
  <script type="module" src="./exports.js"></script>
  <script type="module" src="./ui.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>